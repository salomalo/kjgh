(function($){var CPanel=function(DOMViewSelectors){var chartJS=new Array();var chartOptions={animation:true,scaleFontSize:11,scaleOverride:true,scaleSteps:1,scaleStepWidth:50};var chartData={};var context;var updateStatusSelector="#updatestatus label.label-important";var updateButtonSnippet='<button id="updatebtn" data-content="'+COM_JREALTIME_EXPIREON+'%EXPIREON%" class="btn btn-small btn-primary"><span class="icon-upload"></span>'+COM_JREALTIME_CLICKTOUPDATE+"</button>";var firstProgress='<div class="progress progress-striped active"><div id="progressBar1" class="bar" role="progressbar" aria-valuenow="" aria-valuemin="0" aria-valuemax="100"><span class="sr-only"></span></div></div>';function generateLineChart(elem,context,animation){var elemIndex=$(elem).attr("data-bind").replace(/([{}])/g,"");chartData={};if(!chartJS[elemIndex]){chartJS[elemIndex]=new Chart(context)}var maxValue=10;chartData.labels=new Array();chartData.datasets=new Array();var subDataSet=new Array();$.each(jrealtimeChartData[elemIndex],function(label,value){var labelSuffix=label.replace(/([A-Z])/g,"_$1").toUpperCase();chartData.labels[chartData.labels.length]=eval("COM_JREALTIME_"+labelSuffix+"_CHART");subDataSet[subDataSet.length]=parseInt(value);if(value>maxValue){maxValue=value}});var konstant=1;if(maxValue>100){konstant=10}if(maxValue>1000){konstant=80}if(maxValue>10000){konstant=500}if(maxValue>100000){konstant=5000}chartOptions.scaleStepWidth=parseInt((maxValue*konstant)/(maxValue/10));chartOptions.scaleSteps=parseInt((maxValue/chartOptions.scaleStepWidth)+1);chartData.datasets[0]={fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",data:subDataSet};chartOptions.animation=animation;chartJS[elemIndex].Line(chartData,chartOptions)}function generateMap(){$('div[data-bind="{jr-mapcharts}"]').vectorMap({map:"world_en",color:"#DEDEDE",hoverOpacity:0.7,selectedColor:"#666666",enableZoom:true,showTooltip:true,values:jrealtimeChartData.geomap,scaleColors:["#B4D6E6","#4B97BA"],normalizeFunction:"polynomial",onLabelShow:function(event,label,name,value){label.text(name+": "+value)}})}function resizeRepaintCanvas(canvas,context,animation){var subConstant=1;var currentWindowWidth=$(window).width();if(currentWindowWidth>730){subConstant=1.7}var containerWidth=$(canvas).parent().width()/subConstant;canvas.width=containerWidth;canvas.height=200;generateLineChart(canvas,context,animation)}function checkUpdatesLicenseStatus(){var updateSnippet=updateButtonSnippet;var replacements={"%EXPIREON%":""};if($(updateStatusSelector).length){var ajaxParams={idtask:"getLicenseStatus",param:{}};var uniqueParam=JSON.stringify(ajaxParams);$.ajax({type:"POST",url:"../administrator/index.php?option=com_jrealtimeanalytics&task=ajaxserver.display&format=json",dataType:"json",context:this,async:true,data:{data:uniqueParam},success:function(data,textStatus,jqXHR){if(data.success){replacements={"%EXPIREON%":data.expireon};updateSnippet=updateSnippet.replace(/%\w+%/g,function(all){return replacements[all]||all});$(updateStatusSelector).parent().after(updateSnippet);$("#updatebtn").popover({trigger:"hover",placement:"right"})}}})}}function performComponentUpdate(){var context=this;var modalDialog='<div class="modal fade" id="progessModalUpdate" tabindex="-1" role="dialog" aria-labelledby="progressModal" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">'+COM_JREALTIME_UPDATEPROGRESSTITLE+'</h4></div><div class="modal-body"><p>'+firstProgress+'</p><p id="progressInfo1"></p></div><div class="modal-footer"></div></div><!-- /.modal-content --></div><!-- /.modal-dialog --></div>';$("body").append(modalDialog);var modalOptions={backdrop:"static",keyboard:false};$("#progessModalUpdate").on("shown.bs.modal",function(event){$("#progessModalUpdate div.modal-body").css({width:"90%",margin:"auto"});$("#progressBar1").css({width:"50%"});$("#progressInfo1").empty().append("<p>"+COM_JREALTIME_DOWNLOADING_UPDATE_SUBTITLE+"</p>");var ajaxParams={idtask:"downloadComponentUpdate",param:{}};var uniqueParam=JSON.stringify(ajaxParams);var chained=$.ajax("../administrator/index.php?option=com_jrealtimeanalytics&task=ajaxserver.display&format=json",{type:"POST",data:{data:uniqueParam},dataType:"json"}).then(function(data){$("#progressBar1").css({width:"75%"});$("#progressInfo1").empty().append("<p>"+COM_JREALTIME_INSTALLING_UPDATE_SUBTITLE+"</p>");if(data.result){var ajaxParams={idtask:"installComponentUpdate",param:{}};var uniqueParam=JSON.stringify(ajaxParams);return $.ajax("../administrator/index.php?option=com_jrealtimeanalytics&task=ajaxserver.display&format=json",{type:"POST",data:{data:uniqueParam},dataType:"json"})}else{$("#progressBar1").css({width:"100%"}).addClass("bar-danger");$("#progressInfo1").empty().append("<p>"+data.exception_message+"</p>");setTimeout(function(){$("#progessModalUpdate").modal("hide")},3000);return $.Deferred().reject()}});chained.done(function(data){if(data.result){$("#progressBar1").css({width:"100%"}).addClass("bar-success");$("#progressInfo1").empty().append("<p>"+COM_JREALTIME_COMPLETED_UPDATE_SUBTITLE+"</p>");setTimeout(function(){window.location.reload()},1500)}else{$("#progressBar1").css({width:"100%"}).addClass("bar-danger");$("#progressInfo1").empty().append("<p>"+data.exception_message+"</p>");setTimeout(function(){$("#progessModalUpdate").modal("hide")},3000)}})});$("#progessModalUpdate").modal(modalOptions);$("#progessModalUpdate").on("hidden.bs.modal",function(){$(".modal-backdrop").remove();$(this).remove()})}(function __construct(){if(!!document.createElement("canvas").getContext){$.each(DOMViewSelectors,function(k,elem){context=$(elem).get(0).getContext("2d");var canvas=$(elem).get(0);$(window).on("resize",function(){resizeRepaintCanvas(canvas,context,false)});resizeRepaintCanvas(canvas,context,true)})}var siteSpeedApplication=new JRealtimeControllerSitespeed({container:"sitespeed_container",databind:"jr-sitespeed",targetURL:jrealtimeBaseURI});$("#execute_sitespeed_test").on("click",function(jqEvent){siteSpeedApplication.executeTest()});generateMap();setTimeout(function(){checkUpdatesLicenseStatus()},500);$(document).on("click","#updatebtn",function(jqEvent){performComponentUpdate()})}).call(this)};$(function(){window.JRealtimeCPanel=new CPanel(['*[data-bind="{chart_period_canvas}"]','*[data-bind="{chart_generic_canvas}"]'])})})(jQuery);