(function(c){var d=function(l){var a=l;var r;var q;var b=c(a.piePlaceholder).parents("div.accordion-group").width();var o=c(a.piePlaceholder).parents("div.accordion-group").height();var n=1.1;var m=1.1;var p=new Array();this.renderCharts=function(g){q={};r=g;if(!r){var f=c(a.piePlaceholder).kendoChart({theme:"default",dataSource:{transport:{read:{url:jrealtimeServerStatsEndpoint+"?time="+(new Date().getTime())+"&pie=1&init=1",dataType:"json"}}},legend:{position:"top"},seriesDefaults:{labels:{template:"#= kendo.format('{0:P}', percentage)#",visible:true}},series:[{type:"pie",field:"value",categoryField:"source"}],tooltip:{visible:true,template:"${ category }-${ value } "+COM_JREALTIME_USERS+",#=kendo.format('{0:P}',percentage)#"},transitions:true,chartArea:{width:b/n,height:o/m}});var e=c(a.barPlaceholder).kendoChart({theme:c(document).data("kendoSkin")||"default",dataSource:{transport:{read:{url:jrealtimeServerStatsEndpoint+"?time="+(new Date().getTime())+"&init=1",dataType:"json"}},sort:{field:"year",dir:"asc"}},legend:{position:"top"},seriesDefaults:{type:"column",labels:{visible:true,format:"{0:N0} "+COM_JREALTIME_USERS}},series:[{field:"value",name:COM_JREALTIME_USERS},],categoryAxis:{field:"source",labels:{rotation:-25}},valueAxis:{labels:{format:"{0:N0}"}},tooltip:{visible:true,format:"{0:N0} "+COM_JREALTIME_USERS},transitions:true,chartArea:{width:b/m,height:o/m}});setTimeout(function(){c(f).data("kendoChart").options.transitions=false;c(e).data("kendoChart").options.transitions=false},500)}else{var h=r.slice(0);h.splice(0,3);c(a.barPlaceholder).data("kendoChart").dataSource.data(h);c(a.barPlaceholder).data("kendoChart").refresh();h=r.slice(0);h.splice(0,4);c(a.piePlaceholder).data("kendoChart").dataSource.data(h);c(a.piePlaceholder).data("kendoChart").refresh()}};this.renderTextData=function(e){var f=c(a.textPlaceHolder);c(f).children().remove();if(typeof(e)==="object"){c(f).append('<div class="statslabel blue"><span class="statslabel_value icon-users">'+e[3]["value"]+'</span><span class="statslabel_text">'+e[3]["source"]+"</span></div>");c(f).append('<div class="statslabel green"><span class="statslabel_value icon-user">'+e[4]["value"]+'</span><span class="statslabel_text">'+e[4]["source"]+"</span></div>");c(f).append('<div class="statslabel yellow"><span class="statslabel_value icon-key">'+e[5]["value"]+'</span><span class="statslabel_text">'+e[5]["source"]+"</span></div>");c(f).append('<div id="placeholder_realtimemap"></div>')}};this.renderUserlistStats=function(e){var f=c(a.usersPlaceHolder);c(f).children().remove();if(e){if(e[0].constructor==Array&&e[0].length){c.each(e[0],function(h,y){var D=y.nowpage.match(/\?.+/)?"&":"?";if(!y.name){if(y.current_name){y.name=y.current_name}else{y.name=""}}if(!y.usertype){y.usertype=""}var k="<td>"+y.name+"</td>";var g="<td>"+y.username+"</td>";var B="<td>"+y.usertype+"</td>";var i="<td>"+(new Date(y.lastupdatetime*1000).toLocaleString())+"</td>";var z='<td><a class="preview badge badge-info" title="'+y.nowpage+'" href="'+encodeURI(y.nowpage)+D+'notrack=1">'+y.nowpage+"</a></td>";var C="<td>"+y.geolocation+"</td>";if(p[y.geolocation.toLowerCase()]==undefined){var A=new Image();A.onload=function(){p[y.geolocation.toLowerCase()]=true};A.onerror=function(){p[y.geolocation.toLowerCase()]=false};A.src=jrealtimeBaseURI+"administrator/components/com_jrealtimeanalytics/images/flags/"+y.geolocation.toLowerCase()+".png"}else{if(p[y.geolocation.toLowerCase()]==true){C="<td>"+y.geolocation+' <img src="'+jrealtimeBaseURI+"administrator/components/com_jrealtimeanalytics/images/flags/"+y.geolocation.toLowerCase()+'.png"/></td>'}}var j="<td>"+COM_JREALTIME_NA+"</td>";if(y.device){j="<td>"+y.device+' <img src="'+jrealtimeBaseURI+"administrator/components/com_jrealtimeanalytics/images/devices/"+y.device.toLowerCase()+'.png"/></td>'}c(f).append("<tr>"+k+g+B+i+C+j+z+"</tr>")})}}};this.renderPerPagesStats=function(e){var f=c(a.perpagePlaceHolder);c(f).children().remove();if(e){if(e[1].constructor==Array&&e[1].length){c.each(e[1],function(t,j){var i=j.nowpage.match(/\?.+/)?"&":"?";var g='<td class="large"><a class="preview badge badge-info" title="'+j.nowpage+'" href="'+encodeURI(j.nowpage)+i+'notrack=1" target="_blank">'+j.nowpage+"</a></td>";var k='<td class="little fixed">'+j.numusers+"</td>";var h='<td class="little fixed">'+(new Date(j.lastvisit*1000).toLocaleString())+"</td>";c(f).append("<tr>"+g+k+h+"</tr>")})}}};this.renderErrorMessages=function(f){var e='<div class="alert alert-danger"><h4 class="alert-heading">Error</h4><p>'+f+"</p></div>";c("#system-message-container").append(e)};this.redrawCharts=function(){var e=c(a.piePlaceholder).parents("div.accordion-group").width();var f=c(a.piePlaceholder).parents("div.accordion-group").height();c(a.piePlaceholder).data("kendoChart").options.chartArea.width=e/n;c(a.barPlaceholder).data("kendoChart").options.chartArea.width=e/m;c(a.piePlaceholder).data("kendoChart").options.chartArea.height=f/n;c(a.barPlaceholder).data("kendoChart").options.chartArea.height=f/n;c(a.piePlaceholder).data("kendoChart").refresh(true);c(a.barPlaceholder).data("kendoChart").refresh(true)};this.renderMap=function(e){c("#placeholder_realtimemap").vectorMap({map:"world_en",backgroundColor:"#FFFFFF",color:"#DEDEDE",hoverOpacity:0.7,selectedColor:"#666666",enableZoom:false,showTooltip:true,values:e[2],scaleColors:["#B4D6E6","#4B97BA"],normalizeFunction:"polynomial",onLabelShow:function(h,i,f,g){i.text(f+": "+g)}});if(window.ActiveXObject||window.MSInputMethodContext){c(window).trigger("resize")}}};window.JRealtimeViewRealtimestats=d})(jQuery);