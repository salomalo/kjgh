/**
 * @package    AcyMailing for Joomla
 * @version    6.4.0
 * @author     acyba.com
 * @copyright  (C) 2009-2019 ACYBA S.A.R.L. All rights reserved.
 * @license    GNU/GPLv3 http://www.gnu.org/licenses/gpl-3.0.html
 */

jQuery(document).ready(function(a){var e,t,c=1;a(".acym__campaigns__filter__tags").select2({theme:"foundation",width:"100%"}),a(".acym__campaigns__filter__tags").on("select2:open",function(){a(".select2-search--dropdown .select2-search__field").attr("placeholder",ACYM_JS_TXT.ACYM_SEARCH)}),a(".acym__campaign__recipients__all-lists").select2({width:"100%"}),a(".acym__templates__filter__tags").select2({theme:"foundation",width:"100%"}),a(".acym__campaign__listing__sending__stop").off("click").on("click",function(){var e=a("#acym_form"),t=a(this).attr("data-campaignid");e.append('<input type="hidden" name="stopSendingCampaignId" value="'+t+'">'),e.find('[name="task"]').val("stopSending"),e.submit()}),a(".acym__campaign__listing__scheduled__stop").off("click").on("click",function(){var e=a("#acym_form"),t=a(this).attr("data-campaignid");e.append('<input type="hidden" name="stopScheduledCampaignId" value="'+t+'">'),e.find('[name="task"]').val("stopScheduled"),e.submit()}),a(".acym__campaign__listing__automatic__deactivate").off("click").on("click",function(){var e=a("#acym_form"),t=a(this).attr("data-campaignid");e.append('<input type="hidden" name="id" value="'+t+'">'),e.find('[name="task"]').val("toggleActivateColumnCampaign"),e.submit()}),function(){let e=a("#acym__campaign__choose__campaign").val();e&&0!=e&&a(".acym__templates__oneTpl a, .acym__templates__newTpl a").off("click").on("click",function(a){if(!confirm(ACYM_JS_TXT.ACYM_REPLACE_CONFIRM))return a.preventDefault(),!1})}(),a(".acym__templates__choose__ribbon").off("click").on("click",function(){var e=a(this).prev();window.location.href=e.attr("href")}),a(".acym__templates__pic").on("click",function(){window.location.href=a(this).find("a").attr("href")}),a("#acym__campaigns__attach__add").off("click").on("click",function(){c>9||(a("#acym__campaigns__attach__"+c).css("display",""),c++)}),a(".acym__campaigns__attach__remove").off("click").on("click",function(e){var t=e.currentTarget.getAttribute("data-id");a("#attachments"+t+"selection").html(""),a("#attachments"+t+"suppr").css("display","none"),a("#attachments"+t).val("")}),a(".acym__campaigns__attach__delete").off("click").on("click",function(e){var t=a(".acym__campaigns__attach__delete"),c=a(this),_="",s="";t.each(function(e){a(this).attr("data-id")==c.attr("data-id")&&(_=e,s=c.attr("data-id"))});var i=c.attr("data-mail");a.get(AJAX_URL_ACYM+"&ctrl=campaigns&task=deleteAttach&id="+_+"&mail="+i,function(e){"error"==e?console.log("error deleting"):(console.log("success"),a("#acym__campaigns__attach__del"+s).remove())}).fail(function(a){console.log(a)})}),e=a("#acym__test__field"),t={ctrl:"campaigns",task:"searchTestReceivers"},e.select2({width:"100%",placeholder:e.attr("placeholder"),tags:!0,tokenSeparators:[" ",",",";"],createTag:function(e){var t=a.trim(e.term);return a.acym_emailValid(t)?{id:t,text:t}:null},ajax:{url:AJAX_URL_ACYM,dataType:"json",delay:250,data:function(a){return t.search=a.term,t},processResults:function(e){var t=[];return e&&a.each(e,function(a,e){t.push({id:e[0],text:e[1]})}),{results:t}}},minimumInputLength:3}),a("#launch_spamtest").off("click").on("click",function(){if(a(this).hasClass("acym_icon_disabled"))return!1;a(this).addClass("acym_icon_disabled"),a("#stop_spamtest").removeClass("acym_icon_disabled"),a(".acym_icon_container").find("i").removeClass().html("").addClass("fa fa-circle-o-notch fa-spin"),a(".acym_check_results").hide().html(""),a("#safe_check_results").removeClass("is-hidden"),i("Content","check_words","checkContent"),i("Links","check_links","checkLinks"),i("SPAM","check_spam","checkSPAM")}),a("#stop_spamtest").off("click").on("click",function(){if(a(this).hasClass("acym_icon_disabled"))return!1;for(var e in a(this).addClass("acym_icon_disabled"),_)_.hasOwnProperty(e)&&_[e]&&4!=_[e].readyState&&_[e].abort();a(".acym_icon_container").find("i.fa-circle-o-notch").removeClass("fa-circle-o-notch fa-spin").addClass("fa-question-circle-o"),s=0,a("#launch_spamtest").removeClass("acym_icon_disabled")}),a("#acym__campaigns__listing__show__action").off("change").on("change",function(){a(".acym__campaign__listing__status__controls").toggle()}),a(".campaigns_edit_email").length>0?(a.introContent=[{element:"#dtext_subject_button",text:ACYM_JS_TXT.ACYM_INTRO_ADD_DTEXT,position:"right"}],a.setIntrojs("campaigns_edit_email")):a(".campaigns_tests").length>0&&(a.introContent=[{element:"#spam_test_zone",text:ACYM_JS_TXT.ACYM_INTRO_SAFE_CHECK,position:"right"}],a.setIntrojs("campaigns_tests")),a("#acym__campaign__send-test").off("click").on("click",function(){a("#acym__campaigns__send-test__spinner").show();var e=a(this);e.attr("disabled","true");var t=AJAX_URL_ACYM+"&page=acymailing_campaigns&ctrl=campaigns&task=test&id="+a('input[name="id"]').val()+"&test_emails="+encodeURIComponent(a("#acym__test__field").val().join(","));a.post(t,function(t){e.removeAttr("disabled"),a("#acym__campaigns__send-test__spinner").hide(),t=JSON.parse(t),a.acym_add_notification(t.message,t.type,t.timer)})}),a("#acym__campaign__edit_email").length&&"0"===a("#acym__campaign__recipients__form__campaign").val()&&a("#acym__wysid__edit__button").click(),a(".acym__campaign__sendsettings__buttons-type").off("click").on("click",function(){return!!a(this).hasClass("button-radio-disabled")||!a(this).hasClass("button-radio-unselected")||(a(".acym__campaign__sendsettings__buttons-type").addClass("button-radio-unselected"),a(this).removeClass("button-radio-unselected"),a(".acym__campaign__sendsettings__params").hide(),a('[data-show="'+a(this).attr("id")+'"]').show(),a('[name="sending_type"]').val(a(this).attr("data-sending-type")),void("acym__campaign__sendsettings__scheduled"!==a(this).attr("id")?a("#acym__campaign__sendsettings__send-type-scheduled__date").removeAttr("required"):a("#acym__campaign__sendsettings__send-type-scheduled__date").attr("required","required")))}),function(){let e=a('[name="acym_triggers"]');e.on("change",function(){a(".acym__campaign__sendsettings__params__one").hide(),a('[data-trigger-show="'+a(this).val()+'"]').show(),a(".acym__campaign__sendsettings__params__one select").select2({theme:"foundation",width:"100%"})}),e.trigger("change")}(),a(".acym__campaign__summary__generated__mail__toogle__preview").off("click").on("click",function(){let e=a("#acym__wysid__email__preview");e.hasClass("acym__wysid__email__preview__extend")?e.removeClass("acym__wysid__email__preview__extend"):e.addClass("acym__wysid__email__preview__extend")}),a(".acym__campaign__sendsettings__params__one select").addClass("shrink");var _=[],s=0;function i(e,t,c){var i=a('input[name="id"]').val(),n=a("#"+t).removeClass("acym_clickable").off("click"),l=n.find(".acym_icon_container i");_[e]=a.ajax({url:AJAX_URL_ACYM+"&ctrl=campaigns&task="+c+"&id="+i,success:function(t){if("SPAM"==e){var c=a.parseJSON(t);if("success"==c.type){n.next(".acym_check_results").html(ACYM_JS_TXT.ACYM_TESTS_SPAM_SENT).show();var _=0,i=setInterval(function(){_++,a.getJSON(c.message+"&format=json",function(e){0!=e.status?(clearInterval(i),n.next(".acym_check_results").hide(),e.mark>-2?l.removeClass().addClass("acymicon-check_circle acym_icon_green"):l.removeClass().addClass("acymicon-error acym_icon_red"),n.attr("data-open")||n.attr("data-open",n.attr("data-iframe")),n.addClass("acym_clickable").attr("data-iframe",c.message+"&lang="+c.lang),a.Modal()):_>5&&(n.next(".acym_check_results").html(e.title),n.addClass("acym_clickable").on("click",function(){a(this).next(".acym_check_results").slideToggle()}),l.removeClass().addClass("acymicon-error acym_icon_red"),clearInterval(i))})},1e4)}else n.next(".acym_check_results").html(c.message),n.addClass("acym_clickable").on("click",function(){a(this).next(".acym_check_results").slideToggle()}),l.removeClass().addClass("acymicon-error acym_icon_red")}else t?(l.removeClass().addClass("acymicon-error acym_icon_red"),n.addClass("acym_clickable").on("click",function(){a(this).next(".acym_check_results").slideToggle()}),n.next(".acym_check_results").html(t)):l.removeClass().addClass("acymicon-check_circle acym_icon_green");3==++s&&(s=0,a("#stop_spamtest").addClass("acym_icon_disabled"),a("#launch_spamtest").removeClass("acym_icon_disabled"))}})}});