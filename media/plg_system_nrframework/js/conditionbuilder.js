jQuery(function(s){var r="?option=com_ajax&format=raw&plugin=nrframework&task=ConditionBuilder";function l(e,t,o){s.ajax({url:system_url+r+"&subtask="+e+"&"+token+"=1",data:t,success:function(e){o(e),s(".cb").find("select").chosen({disable_search_threshold:10}).end().find(".hasPopover").popover({html:!0,trigger:"hover focus",container:"body"})},error:function(e,t,o){alert(o)}})}system_url=s(".cb").attr("data-root"),token=s(".cb").attr("data-token"),s(document).on("click",".addCondition",function(e){e.preventDefault();var t,o,r,n,a,c,i=s(".cb");$element=s(e.target).closest(".cb-item"),$controlGroup=$element.closest(".cb-group"),$controlGroup.length?(groupKey=parseInt($controlGroup.attr("data-key")),conditionKey=parseInt($controlGroup.attr("data-max-index"))+1):(groupKey=parseInt(i.attr("data-max-index"))+1,conditionKey=0),t=$element,o=i.data("control-group"),r=groupKey,n=conditionKey,a=0==t.closest(".cb-group").length,l("add",c={controlgroup:o,groupKey:r,conditionKey:n,conditionsList:s(".cb").attr("data-conditionslist")},function(e){a?(s("<div/>").addClass("cb-group").attr("data-key",c.groupKey).attr("data-max-index",0).appendTo(".cb-items").html(e),s(".cb").attr("data-max-index",c.groupKey)):(t.after(e),t.closest(".cb-group").attr("data-max-index",n))})}),s(document).on("click",".removeCondition",function(e){e.preventDefault(),function(e){if(1==s(".cb-item").length)return alert("You can't remove the last item");$group=e.closest(".cb-group"),e.remove(),0==$group.children().length&&$group.remove()}(s(e.target).closest(".cb-item"))}),s(document).on("change",".condition_selector",function(e){e.preventDefault();var t,o,r,n=s(e.target).closest(".cb-item");condition_name=s(this).val(),t=n,o=condition_name,r=t.closest(".cb"),groupKey=parseInt(t.closest(".cb-group").attr("data-key")),conditionKey=parseInt(t.closest(".cb-item").attr("data-key")),options={controlgroup:r.attr("data-control-group")+"["+groupKey+"]["+conditionKey+"]",name:o},l("options",options,function(e){t.find(".cb-item-content").html(e),s(document).trigger("afterConditionSettings",[t,o])})}),s(document).on("afterConditionSettings",function(e,t,o){!function(e,t){var o=system_url.replace("/administrator","");switch(e){case"usergroup":case"menu":case"category":case"k2category":NRHelper.loadStyleSheet(o+"/media/plg_system_nrframework/css/treeselect.css"),NRHelper.loadScript(o+"/media/plg_system_nrframework/js/treeselect.js",function(){NRTreeselect.init(t.get(0))});break;case"date":NRHelper.loadStyleSheet(o+"/media/system/css/fields/calendar.css"),NRHelper.loadScript(o+"/media/system/js/fields/calendar-locales/en.js"),NRHelper.loadScript(o+"/media/system/js/fields/calendar-locales/date/gregorian/date-helper.min.js"),NRHelper.loadScript(o+"/media/system/js/fields/calendar.min.js",function(){var e=t.get(0).querySelectorAll(".field-calendar");for(i=0;i<e.length;i++)JoomlaCalendar.init(e[i])});break;case"time":NRHelper.loadStyleSheet(o+"/media/plg_system_nrframework/css/jquery-clockpicker.min.css"),NRHelper.loadScript(o+"/media/plg_system_nrframework/js/jquery-clockpicker.min.js",function(){t.find(".clockpicker").clockpicker()})}"date"!=e&&s(document).trigger("subform-row-add")}(o,t)})});